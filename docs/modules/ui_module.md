# 모듈 상세: ui.py

`ui.py` 모듈은 게임의 모든 사용자 인터페이스(UI) 요소를 터미널에 렌더링하는 책임을 가집니다. 화면 깜빡임을 최소화하고 부드러운 애니메이션 효과를 위해 더블 버퍼링 기술을 사용합니다.

## 1. 주요 기능 및 책임

-   **터미널 초기화**: 터미널 크기 설정, 커서 숨기기, 원시 모드 설정 등.
-   **화면 렌더링**: 맵, 플레이어 스탯, 메시지 로그, 인벤토리 등 모든 게임 요소를 터미널에 그립니다.
-   **더블 버퍼링 구현**: 백그라운드 버퍼에 UI를 그린 후 한 번에 화면에 출력하여 깜빡임을 방지합니다.
-   **ANSI 이스케이프 코드 활용**: 색상, 커서 위치 제어, 화면 지우기 등 터미널 제어를 위한 ANSI 코드 사용.
-   **사용자 입력 처리 (선택 사항)**: 일부 UI 상호작용(예: 메뉴 선택)에 대한 입력 처리도 포함될 수 있습니다. (현재는 `game.py`에서 `readchar` 사용)

## 2. 핵심 변수 및 함수 상세

### `_screen_buffer` (내부 버퍼)

-   **목적**: 현재 화면에 표시될 내용을 미리 저장하는 2차원 리스트 또는 문자열 버퍼입니다.
-   **디자인 결정**: 이 버퍼에 모든 UI 요소를 그린 후, 한 번에 터미널로 출력하여 화면 깜빡임을 방지합니다.

### `clear_screen()`

-   **목적**: 터미널 화면을 지우고 커서를 홈 위치로 이동시킵니다.
-   **구현 상세**: ANSI 이스케이프 코드 `\033[2J\033[H` 사용.

### `draw_map(game_map)`

-   **목적**: 게임 맵을 화면 버퍼에 그립니다.
-   **구현 상세**: `game_map`의 각 셀을 순회하며 `_screen_buffer`에 해당 문자를 배치합니다.

### `draw_player_stats(player)`

-   **목적**: 플레이어의 현재 스탯(HP, MP, LV, EXP 등)을 화면 버퍼의 특정 위치에 그립니다.
-   **구현 상세**: ANSI 색상 코드를 사용하여 가독성을 높일 수 있습니다.

### `draw_message_log(messages)`

-   **목적**: 게임 메시지(예: "몬스터를 만났습니다", "아이템을 획득했습니다")를 화면 하단에 표시합니다.
-   **구현 상세**: 메시지 스크롤링, 시간 제한 표시 등을 구현할 수 있습니다.

### `draw_inventory(player_inventory, is_active)` (향후 구현)

-   **목적**: 인벤토리 창을 화면 버퍼에 그립니다.
-   **구현 상세**: `i` 키를 눌렀을 때 활성화되는 오버레이 UI로 구현될 예정입니다. 아이템 목록, 수량, 장비 슬롯 등을 표시합니다.

### `render()`

-   **목적**: `_screen_buffer`에 그려진 모든 내용을 터미널에 한 번에 출력합니다.
-   **구현 상세**: `sys.stdout.write()`를 사용하여 효율적으로 출력합니다.

## 3. 더블 버퍼링 원칙

-   **단계 1: 버퍼 초기화**: 매 렌더링 주기마다 `_screen_buffer`를 빈 상태로 초기화합니다.
-   **단계 2: 버퍼에 그리기**: 모든 `draw_xxx()` 함수들은 실제 터미널에 직접 그리지 않고, `_screen_buffer`에 내용을 채웁니다.
-   **단계 3: 한 번에 출력**: 모든 그리기 작업이 완료되면, `render()` 함수가 `_screen_buffer`의 내용을 터미널에 한 번에 출력합니다.
-   **이점**: 화면 깜빡임(flickering)을 방지하고 부드러운 UI 업데이트를 가능하게 합니다.

## 4. ANSI 이스케이프 코드 활용

-   **색상**: `\033[31m` (빨간색), `\033[0m` (색상 초기화) 등.
-   **커서 이동**: `\033[y;xH` (y행 x열로 이동).
-   **화면 지우기**: `\033[2J` (화면 전체 지우기).
-   **커서 숨기기/보이기**: `\033[?25l` (숨기기), `\033[?25h` (보이기).
-   **주의 사항**: 모든 터미널이 모든 ANSI 코드를 완벽하게 지원하는 것은 아니지만, 대부분의 최신 리눅스 터미널에서는 잘 작동합니다.

## 5. 다른 모듈과의 상호작용

-   **`game.py`**: 메인 게임 루프에서 `ui.py`의 `draw_map()`, `draw_player_stats()`, `draw_message_log()`, `render()` 등의 함수를 호출하여 화면을 업데이트합니다.
-   **`player.py`**: 플레이어의 스탯, 인벤토리 정보를 `ui.py`에 전달하여 렌더링하도록 합니다.
-   **`dungeon_map.py`**: 맵 데이터를 `ui.py`에 전달하여 맵을 그립니다.

## 6. 잠재적 문제 및 고려 사항

-   **터미널 크기 변화**: 터미널 크기가 게임 실행 중에 변경될 경우, UI 레이아웃이 깨질 수 있습니다. 이를 감지하고 UI를 재조정하는 로직이 필요할 수 있습니다.
-   **성능**: 복잡한 UI 요소가 많아지면 렌더링 성능에 영향을 줄 수 있습니다. 효율적인 그리기 로직이 중요합니다.
-   **확장성**: 새로운 UI 요소(예: 스킬 메뉴, 상점)를 추가할 때, `ui.py` 내부에 새로운 `draw_xxx()` 함수를 추가하고 `render()`에서 이를 호출하도록 설계해야 합니다.

## 7. 향후 UI 구현 계획

### 인벤토리
- **키 바인딩**:
    - **탭 전환**: a(아이템), b(장비), c(스크롤), d(스킬북)
    - **버리기**: R
    - **장비 장착**: E 또는 e
    - **아이템/스크롤 퀵슬롯 등록**: 1-5
    - **스킬북 퀵슬롯 등록**: 6-0
- **리스트 표시 형식**:
    - **일반 아이템**: `아이템 이름x개수 : 효과` (예: `체력소회복포션 x 10 : 체력 회복 10`)
    - **스킬북**: `스킬북 이름 : 필요 레벨, 속성, 사용 수치, 필요 장비, 효과` (예: `휠윈드 : lv 13, MP-10, 쌍도끼, 주변 4방향 공격, 데미지 40`)
- **네비게이션**: 상/하 화살표 키로 스크롤

### 퀵슬롯
- **표시 형식**:
    - **아이템 (1-5)**: `슬롯번호 : 아이템 이름 X 개수` (예: `1 : 체력소회복포션 X 10`)
    - **스킬 (6-0)**: `슬롯 번호 : 이름 : 스킬 레벨 : 현재경험치 / 다음 레벨까지 필요한 경험치` (예: `6 : 휠 윈드 : Lv2 : 10/200`)
- **네비게이션**: 상/하 화살표 키로 스크롤

### 메인 게임 화면 인터페이스
- **하단 스탯 표시줄**:
    - 현재 위치
    - 체력 : 00000/00000
    - 마력 : 00000/00000
    - 스테미너 : 00000/00000
    - 레벨
    - 경험치
    - 직업
- **우측 퀵슬롯 표시줄**:
    ```
    --- 퀵 슬롯 ---
    1
    2
    3
    4
    5
    --- 스킬 ---
    6
    7
    8
    9
    0
    ```
