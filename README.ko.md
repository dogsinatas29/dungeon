# 던전 크롤 (Dungeon Crawl)
![Dungeon Crawl Title Screen](assets/title_screen.png)

[English](README.md) | **한국어**

Diablo like real time rogue for terminal

![Gameplay Screenshot](screenshots/gameplay_test.png)

### [게임플레이 영상 보기](https://youtu.be/o8M7aBofsvQ)

**참고**: 이 프로젝트는 Gemini를 페어 프로그래밍 도우미로 사용하여 개발되었습니다.

**상태**: 현재 밸런스 테스트 진행 중...

## 주요 기능

### 핵심 게임플레이
- **실시간 전투 시스템** - 턴 기반 메커니즘
- **절차적 생성 던전** - 다양한 층 타입
- **영구 사망** - 진정한 로그라이크 경험
- **캐릭터 성장** - 스킬 사용에 따른 동적 직업 시스템
- **직업별 특성화**: 각 직업별 고유 무기 보너스 (로그 활, 바바리안 양손무기, 소서러 지팡이)

### 전투 & 스킬
- **18개 디아블로 1 스펠** (4개 티어):
  - 1티어: 파이어볼트, 차지드 볼트, 치유, 홀리 볼트, 인페르노
  - 2티어: 파이어볼, 라이트닝, 석화 저주, 플래시, 페이징
  - 3티어: 체인 라이트닝, 플레임 웨이브, 가디언, 텔레포트
  - 4티어: 마나 실드, 노바, 골렘, 아포칼립스
- **스킬북 시스템** - 지수 레벨링 (3^n 진행: 1→3→9→27권)
- **속성 시스템** - 가위바위보 메커니즘 (물 > 불 > 나무 > 흙 > 물)
- **특수 데미지 타입** - 독, 언데드 보너스(둔기), 원거리 공격

### 아이템 & 장비
- **99개 이상의 기본 아이템**:
  - 30개 무기 (검, 도끼, 둔기, 활, 지팡이)
  - 26개 방어구 (투구, 방패, 갑옷)
  - 2개 액세서리 (반지, 목걸이)
  - 18개 스킬북
  - 다양한 소비 아이템 및 스크롤

### 디아블로 1 스타일 시스템
- **마법 아이템 시스템** - 접두사/접미사 조합:
  - 22개 접두사 (날카로운, 흑요석, 용의 등)
  - 17개 접미사 (황도십이궁의, 천상의 등)
  - 11개 액세서리 전용 접두사 (비취, 루비, 사파이어 등)
  - 2개 액세서리 전용 접미사 (달의, 재생의)
- **내구도 시스템** - 전투 중 장비 마모
- **강화 시스템**:
  - 무기/방어구용 오일 강화
  - 신전 강화 (0 ~ +10) - 성공/실패 메커니즘
- **신전 시스템** - 2층마다 등장, 복구 또는 강화 옵션

### 고급 기능
- **스테미너 시스템** - 이동 및 스킬 사용 시 소모
- **자원 관리** - 식량, 물약, 인벤토리 제한
- **상점 시스템** - 아이템 구매/판매 및 수리
- **사운드 시스템** - 행동에 대한 오디오 피드백
- **더블 버퍼 UI** - ANSI 색상을 사용한 부드러운 터미널 렌더링
- **저장/불러오기** - 영구 게임 상태

## 최근 업데이트 (2025-12-31)

### 1. 고급 신전 및 강화 시스템
- **오일 시스템**: 무기/방어구에 영구적인 능력치 보너스 및 유틸리티 부여.
- **제물 시스템**: 강화 성공률 보정 및 아이템 보호 기능.
- **파괴 메커니즘**: 신전은 강력한 일회성 오브젝트로, 사용 후 파괴됩니다.

### 2. 스킬 시스템 고도화 (Phase 1-3 완료)
- **Phase 1 (유틸리티)**: `수리(REPAIR)`, `함정 해제(DISARM)`, `충전(RECHARGE)`, `마나 실드(MANA_SHIELD)`의 실질 로직 구현.
- **Phase 2 (이동)**: `무작위 순간이동(PHASING)` 및 `지정 순간이동(TELEPORT)` 구현.
- **Phase 3 (광역 마법)**: `플래시(FLASH)`, `노바(NOVA)`, `연쇄 번개(CHAIN_LIGHTNING)`, `화염 파동(FLAME_WAVE)`의 범위 판정 및 전이 로직 구현.

### 3. 엔진 및 UI 개선
- **대형 맵 지원**: 99층 규모의 대형 맵에서 카메라 렌더링 버그 수정.
- **안정성 확보**: 전투 및 렌더링 시스템에서 발생하던 여러 `UnboundLocalError` 해결.
- **시각 효과**: 던전 테마(동굴, 지옥)별 배경 파티클 효과 추가.
- **샌드박스**: 테스트용 층 이동(F/B/J) 및 골드 획득(G) 명령어 추가.

### 높은 우선순위
- [x] **디아블로 1 보스 시스템**:
    - [x] **보스 소환 매커니즘** (체력 50% 시 지원군 소환)
    - [x] **공격적 보스 AI** (모든 보스가 플레이어를 추적)
    - [x] **최종 보스: 디아블로** (99층에서의 대결)
    - [ ] 다른 유니크 보스들 (도살자, 레오릭 등)
    - [ ] 보스 대사 시스템 ("Ah... Fresh Meat!")
    - [ ] 보스별 유니크 아이템 드랍 보장
    - [x] 보스 전용 고정 맵 (99층 목표 달성)
- [x] **스킬 시스템 구현 (Phase 1-3)**:
    - [x] 유틸리티 스킬 (수리, 함정 해제, 충전)
    - [x] 생존 기술 (마나 실드, 페이징, 텔레포트)
    - [x] 공격 마법 (플래시, 노바, 체인 라이트닝, 플레임 웨이브)
- [ ] **스킬 시스템 구현 (Phase 4)**:
    - [ ] 가디언 - 터렛 소환
    - [ ] 골렘 - 골렘 소환
    - [ ] 아포칼립스 - 화면 전체 공격

### 중간 우선순위
- [ ] **아이템 드롭 시스템 개선**:
  - [ ] 드롭 확률 공식 (일반 15-25%, 보스 100%)
  - [ ] 등급 결정 (Normal 85%, Magic 14.5%, Unique 0.5%)
  - [ ] 몬스터 레벨 기반 아이템 제한
  - [ ] 매직 접사 롤링 (접두사 40%, 접미사 40%, 둘 다 20%)
  - [ ] Magic Find (MF) 시스템 (장신구)
  - [ ] 보스 전용 드롭 테이블
- [ ] **언어 선택 메뉴** - 시작 시 한글/영어 선택
- [ ] **동적 직업 시스템** - 최고 레벨 스킬에 따라 직업 자동 변경
- [ ] **플레이어 행동 쿨다운** - 입력 처리에서 쿨다운 강제
- [ ] **밸런스 조정** - 실시간 게임플레이에 맞춰 난이도 조정
- [ ] **UI 개선**:
  - [ ] 쿨다운 표시
  - [ ] 실시간 HP/MP 바 애니메이션
  - [ ] 몬스터 행동 예측 표시

### 낮은 우선순위
- [ ] **보스 특수 패턴** - 고유한 보스 행동
- [ ] **추가 캐릭터 클래스** - 4개 이상으로 확장
- [ ] **멀티플레이어 지원** - 협동 게임플레이

## 요구 사항

```bash
sudo apt install python3-gi python3-gi-cairo python3-dbus gir1.2-gtk-3.0
pip install readchar
```

## 플레이 방법

```bash
python3 dungeon/Start.py
```

## 테스트

### 테스트 환경 (test_classes.py)

모든 게임 기능을 종합적으로 테스트하려면 테스트 환경 스크립트를 사용하세요:

```bash
python3 test_classes.py
```

**기능**:
- 레벨 10으로 사전 구성된 캐릭터
- 상점 테스트용 골드 10,000
- 모든 무기, 방어구, 액세서리
- 모든 스킬북 (Lv1-3) 전체 마법
- 각 소모품 99개
- 강화된 능력치 (모든 속성 +10)

**사용 가능한 테스트 직업**:
1. **전사** - 높은 HP (180), STR 40, 근접 전투 특화
2. **도적** - 높은 DEX (40), 치명타, 함정 전문가
3. **마법사** - 높은 MAG (40), 마법 데미지 특화
4. **바바리안** - 최고 HP (240), STR 50, 광전사

**테스트 항목**:
- 캐릭터 성장
- 상점 상호작용

### 샌드박스 환경 (sandbox_test.py)

고급 게임 로직(신전, 보스, 접두사/접미사 아이템)을 테스트하기 위한 환경:

```bash
python3 sandbox_test.py
```

**기능**:
- 플레이어 레벨 99 및 능력치 최대화 (STR/MAG/DEX/VIT 100)
- 고급 신전 재료 지급 (오일 및 제물 99개)
- 검증용 특수 접사 아이템(유니크 스타일) 지급
- 신전 및 보스 조우에 즉각적인 접근 가능

**디버그 단축키 (샌드박스 전용)**:
- `F`: 앞(Forward)으로 **10층 이동**
- `B`: 뒤(Backward)로 **10층 이동**
- `J`: 특정 층으로 **직접 이동** (터미널에 층수 입력)
- `G`: **1,000 골드** 즉시 획득

### 조작법
- **방향키**: 캐릭터 이동
- **스페이스**: 공격 모드 전환
- **I**: 인벤토리 열기
- **Q**: 게임 종료
- **1-9**: 퀵슬롯 사용

### 게임 메커니즘

#### 능력치
- **HP**: 생명력
- **MP**: 스킬 사용을 위한 마나
- **스테미너**: 이동(20타일 = 1 스테미너) 및 스킬 사용 시 소모
- **STR/DEX/MAG/VIT**: 전투 및 장비에 영향을 주는 핵심 능력치

#### 직업별 특수 능력 (Specialization)
- **워리어 (Warrior)**: 높은 방어력과 체력. 모든 무기 종류를 능숙하게 다룹니다.
- **도적 (Rogue)**: **활의 명수**. 활 사용 시 **사거리 +3** 보너스를 받으며, 화살이 항상 적을 **관통**합니다.
- **바바리안 (Barbarian)**: **양손 무기의 달인**. 양손 무기 사용 시 **공격력 +3** 및 **사거리 +1** 보너스를 받습니다.
- **마법사 (Sorcerer)**: **지팡이 마력 충전**. 지팡이 장착 시 MP 대신 지팡이의 **충전량(Charge)**을 사용하여 마법을 시전할 수 있습니다.

#### 전투
- **공격 타입**: 근접, 원거리, 투사체, 범위
- **방어**: 방패와 갑옷이 데미지 감소
- **속성 우위**: 올바른 속성 조합으로 보너스 데미지
- **내구도 손실**: 공격자의 무기와 방어자의 갑옷에 타격당 10% 확률

#### 성장
- **동적 직업**: 가장 높은 레벨의 스킬에 따라 직업 변경
- **스킬 레벨링**: 여러 스킬북을 읽어 레벨업 (1→3→9→27권)
- **아이템 강화**: 오일이나 신전을 사용하여 장비 업그레이드
- **영구 능력치**: 엘릭서로 영구 능력치 증가

## 프로젝트 구조

```
dungeon/
├── Start.py              # 메인 진입점
├── dungeon/
│   ├── game.py          # 메인 게임 루프
│   ├── engine.py        # 게임 엔진 및 상태 관리
│   ├── ecs.py           # Entity Component System
│   ├── components.py    # ECS 컴포넌트
│   ├── systems.py       # ECS 시스템 (전투, 이동 등)
│   ├── player.py        # 플레이어 클래스
│   ├── dungeon_map.py   # 맵 생성
│   ├── ui.py            # 터미널 UI 렌더링
│   ├── data_manager.py  # 데이터 로딩
│   └── sound_system.py  # 오디오 시스템
├── test_classes.py       # 직업별 밸런스 테스트용
├── sandbox_test.py       # 고급 시스템 및 샌드박스 테스트용
├── sounds/               # 오디오 효과음 파일 (.wav)
├── data/
│   ├── items.csv        # 아이템 정의
│   ├── skills.csv       # 스킬 정의
│   ├── prefixes.json    # 마법 아이템 접두사
│   ├── suffixes.json    # 마법 아이템 접미사
│   └── monster_data.txt # 몬스터 정의
└── game_data/           # 저장 파일 (JSON)
```

## 개발

### 코딩 스타일
- PEP 8 표준 준수
- 자동 포맷팅은 `black` 사용

### 주요 디자인 패턴
- **ECS 아키텍처**: 데이터(컴포넌트)와 로직(시스템) 분리
- **이벤트 기반**: 게임 이벤트를 위한 이벤트 매니저
- **데이터 기반**: CSV/JSON 파일로 정의된 아이템, 스킬, 몬스터

## 라이선스

이 프로젝트는 교육 목적으로 오픈 소스입니다.

---

**Gemini AI를 페어 프로그래밍 도우미로 사용하여 개발됨**
