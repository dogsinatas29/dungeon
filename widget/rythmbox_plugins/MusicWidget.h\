#ifndef MUSIC_WIDGET_H
#define MUSIC_WIDGET_H

#include <gtkmm.h>
#include <giomm.h> // GIO/DBus 래퍼를 위해

class MusicWidget : public Gtk::Window
{
public:
    MusicWidget();
    virtual ~MusicWidget();

protected:
    // Signal handlers
    bool on_draw(const Cairo::RefPtr<Cairo::Context>& cr);
    bool on_button_press_event(GdkEventButton* event);
    bool on_button_release_event(GdkEventButton* event);
    bool on_motion_notify_event(GdkEventMotion* event);
    void on_opacity_scale_changed();
    void on_prev_clicked();
    void on_play_pause_clicked();
    void on_next_clicked();

    // DBus related
    void init_dbus();
    void update_player_status();
    void call_player_method(const Glib::ustring& method_name);
    void on_name_owner_changed(const Glib::RefPtr<Gio::DBus::Connection>& connection,
                               const Glib::ustring& sender_name,
                               const Glib::ustring& node_name,
                               const Glib::ustring& old_owner,
                               const Glib::ustring& new_owner);

    // Spectrum update
    bool update_spectrum_data();

    // UI elements
    Gtk::Box m_MainBox;
    Gtk::HBox m_TopHBox;
    Gtk::VBox m_PlayerInfoControlsVBox;
    Gtk::HBox m_ControlHBox;

    Gtk::Image m_AlbumArt;
    Gtk::Label m_TrackLabel;
    Gtk::Label m_ArtistLabel;
    Gtk::Button m_PrevButton;
    Gtk::Button m_PlayPauseButton;
    Gtk::Button m_NextButton;
    Gtk::DrawingArea m_SpectrumDrawingArea;
    Gtk::Scale m_OpacityScale;

    // Dragging variables
    bool m_is_dragging;
    int m_drag_start_x;
    int m_drag_start_y;

    // DBus variables
    Glib::RefPtr<Gio::DBus::Connection> m_dbus_connection;
    Glib::ustring m_current_player_bus_name;

    // Spectrum data (simulated for now)
    std::vector<double> m_spectrum_data;
};

#endif // MUSIC_WIDGET_H
